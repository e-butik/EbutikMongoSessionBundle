<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
  <parameters>
      <parameter key="ebutik.mongosession.storage.class">Ebutik\MongoSessionBundle\SessionStorage\MongoODMSessionStorage</parameter>
      <parameter key="ebutik.mongosession.listener.class">Ebutik\MongoSessionBundle\EventListener\MongoSessionListener</parameter>
      <parameter key="ebutik.mongosession.key_escaper.class">Ebutik\MongoSessionBundle\Escaper\Escaper</parameter>
  </parameters>
  
  <services>
      <service id="ebutik.mongosession.storage" class="%ebutik.mongosession.storage.class%">
        <argument type="service" id="ebutik.mongosession.document_manager"/>
        <argument type="service" id="ebutik.mongosession.key_escaper"/>
        <argument>%session.storage.options%</argument>
      </service>
      <service id="ebutik.mongosession.listener" class="%ebutik.mongosession.listener.class%">
        <argument type="service" id="ebutik.mongosession.storage" />

        <tag name="kernel.listener" event="core.request" method="onCoreRequest" priority="50" />
        <tag name="kernel.listener" event="core.response" method="onCoreResponse" priority="-50" />
      </service>

      <service id="ebutik.mongosession.key_escaper" class="%ebutik.mongosession.key_escaper.class%">
        <call method="setDelimiter">
          <argument></argument>
          <argument>&gt;</argument>
        </call>
      </service>
  </services>
</container>